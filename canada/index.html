<!DOCTYPE html>
<head>
<title>Data Visualization</title>
<meta charset="utf-8">
<style>

html, body { margin:0; padding:0; overflow:hidden }
svg { position:fixed; top:0; left:0; height:100%; width:100% }

.background {
  fill: none;
  pointer-events: all;
}

.feature {
  fill: #ccc;
  cursor: pointer;
}

.feature.active {
  fill: orange;
}

.mesh {
  fill: none;
  stroke: #fff;
  stroke-linecap: round;
  stroke-linejoin: round;
}

</style>

</head>

<script src="https://d3js.org/d3.v6.js"></script>
<script src="https://d3js.org/topojson.v3.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

</script>

<body onload="init()">

<div id="scene"></dvi>

</body>
<script type="text/javascript" src="annotations.js"></script>
<script>

async function init() {

populationData = {"Canada": {"Before 1980": 2320.0, "1980": 3835.4545454545455, "1981": 3835.4545454545455, "1982": 5350.909090909091, "1983": 6866.363636363636, "1984": 8381.818181818182, "1985": 9897.272727272728, "1986": 11412.727272727274, "1987": 12928.18181818182, "1988": 14443.636363636366, "1989": 15959.090909090912, "1990": 17474.545454545456, "19801990": 18990.0, "1991": 23112.0, "1992": 27234.0, "1993": 31356.0, "1994": 35478.0, "1995": 39600.0, "1996": 43722.0, "1997": 47844.0, "1998": 51966.0, "1999": 56088.0, "2000": 60210.0, "19912000": 60210.0, "2001": 65273.0, "2002": 70336.0, "2003": 75399.0, "2004": 80462.0, "2005": 85525.0, "20012005": 85525.0, "2006": 90931.0, "2007": 96337.0, "2008": 101743.0, "2009": 107149.0, "2010": 112555.0, "20062010": 112555.0, "2011": 121503.0, "2012": 130451.0, "2013": 139399.0, "2014": 148347.0, "2015": 157295.0, "20112015": 157295.0, "2016": 162425.0, "2017": 167555.0, "2018": 172685.0, "2019": 177815.0, "2020": 182945.0, "20162021": 182945.0, "2021": 193945.0, "2022": 205245.0, "2023": 216745.0}, "Newfoundland and Labrador": {"Before 1980": 0.0, "1980": 0.0, "1981": 0.0, "1982": 0.0, "1983": 0.0, "1984": 0.0, "1985": 0.0, "1986": 0.0, "1987": 0.0, "1988": 0.0, "1989": 0.0, "1990": 0.0, "19801990": 0.0, "1991": 1.0, "1992": 2.0, "1993": 3.0, "1994": 4.0, "1995": 5.0, "1996": 6.0, "1997": 7.0, "1998": 8.0, "1999": 9.0, "2000": 10.0, "19912000": 10.0, "2001": 14.0, "2002": 18.0, "2003": 22.0, "2004": 26.0, "2005": 30.0, "20012005": 30.0, "2006": 33.0, "2007": 36.0, "2008": 39.0, "2009": 42.0, "2010": 45.0, "20062010": 45.0, "2011": 57.0, "2012": 69.0, "2013": 81.0, "2014": 93.0, "2015": 105.0, "20112015": 105.0, "2016": 112.0, "2017": 119.0, "2018": 126.0, "2019": 133.0, "2020": 140.0, "20162021": 140.0, "2021": 140.0, "2022": 140.0, "2023": 140.0}, "Prince Edward Island": {"Before 1980": 0.0, "1980": 1.8181818181818181, "1981": 1.8181818181818181, "1982": 3.6363636363636362, "1983": 5.454545454545454, "1984": 7.2727272727272725, "1985": 9.09090909090909, "1986": 10.909090909090908, "1987": 12.727272727272727, "1988": 14.545454545454545, "1989": 16.363636363636363, "1990": 18.18181818181818, "19801990": 20.0, "1991": 20.0, "1992": 20.0, "1993": 20.0, "1994": 20.0, "1995": 20.0, "1996": 20.0, "1997": 20.0, "1998": 20.0, "1999": 20.0, "2000": 20.0, "19912000": 20.0, "2001": 22.0, "2002": 24.0, "2003": 26.0, "2004": 28.0, "2005": 30.0, "20012005": 30.0, "2006": 44.0, "2007": 58.0, "2008": 72.0, "2009": 86.0, "2010": 100.0, "20062010": 100.0, "2011": 114.0, "2012": 128.0, "2013": 142.0, "2014": 156.0, "2015": 170.0, "20112015": 170.0, "2016": 173.0, "2017": 176.0, "2018": 179.0, "2019": 182.0, "2020": 185.0, "20162021": 185.0, "2021": 185.0, "2022": 185.0, "2023": 185.0}, "Nova Scotia": {"Before 1980": 10.0, "1980": 20.0, "1981": 20.0, "1982": 30.0, "1983": 40.0, "1984": 50.0, "1985": 60.0, "1986": 70.0, "1987": 80.0, "1988": 90.0, "1989": 100.0, "1990": 110.0, "19801990": 120.0, "1991": 128.0, "1992": 136.0, "1993": 144.0, "1994": 152.0, "1995": 160.0, "1996": 168.0, "1997": 176.0, "1998": 184.0, "1999": 192.0, "2000": 200.0, "19912000": 200.0, "2001": 228.0, "2002": 256.0, "2003": 284.0, "2004": 312.0, "2005": 340.0, "20012005": 340.0, "2006": 396.0, "2007": 452.0, "2008": 508.0, "2009": 564.0, "2010": 620.0, "20062010": 620.0, "2011": 661.0, "2012": 702.0, "2013": 743.0, "2014": 784.0, "2015": 825.0, "20112015": 825.0, "2016": 869.0, "2017": 913.0, "2018": 957.0, "2019": 1001.0, "2020": 1045.0, "20162021": 1045.0, "2021": 1045.0, "2022": 1045.0, "2023": 1045.0}, "New Brunswick": {"Before 1980": 0.0, "1980": 5.454545454545454, "1981": 5.454545454545454, "1982": 10.909090909090908, "1983": 16.363636363636363, "1984": 21.818181818181817, "1985": 27.27272727272727, "1986": 32.72727272727273, "1987": 38.18181818181818, "1988": 43.63636363636363, "1989": 49.090909090909086, "1990": 54.54545454545454, "19801990": 60.0, "1991": 64.0, "1992": 68.0, "1993": 72.0, "1994": 76.0, "1995": 80.0, "1996": 84.0, "1997": 88.0, "1998": 92.0, "1999": 96.0, "2000": 100.0, "19912000": 100.0, "2001": 109.0, "2002": 118.0, "2003": 127.0, "2004": 136.0, "2005": 145.0, "20012005": 145.0, "2006": 159.0, "2007": 173.0, "2008": 187.0, "2009": 201.0, "2010": 215.0, "20062010": 215.0, "2011": 243.0, "2012": 271.0, "2013": 299.0, "2014": 327.0, "2015": 355.0, "20112015": 355.0, "2016": 388.0, "2017": 421.0, "2018": 454.0, "2019": 487.0, "2020": 520.0, "20162021": 520.0, "2021": 520.0, "2022": 520.0, "2023": 520.0}, "Quebec": {"Before 1980": 430.0, "1980": 622.7272727272727, "1981": 622.7272727272727, "1982": 815.4545454545455, "1983": 1008.1818181818182, "1984": 1200.909090909091, "1985": 1393.6363636363637, "1986": 1586.3636363636365, "1987": 1779.0909090909092, "1988": 1971.818181818182, "1989": 2164.5454545454545, "1990": 2357.272727272727, "19801990": 2550.0, "1991": 2893.0, "1992": 3236.0, "1993": 3579.0, "1994": 3922.0, "1995": 4265.0, "1996": 4608.0, "1997": 4951.0, "1998": 5294.0, "1999": 5637.0, "2000": 5980.0, "19912000": 5980.0, "2001": 6240.0, "2002": 6500.0, "2003": 6760.0, "2004": 7020.0, "2005": 7280.0, "20012005": 7280.0, "2006": 7718.0, "2007": 8156.0, "2008": 8594.0, "2009": 9032.0, "2010": 9470.0, "20062010": 9470.0, "2011": 10795.0, "2012": 12120.0, "2013": 13445.0, "2014": 14770.0, "2015": 16095.0, "20112015": 16095.0, "2016": 16921.0, "2017": 17747.0, "2018": 18573.0, "2019": 19399.0, "2020": 20225.0, "20162021": 20225.0, "2021": 21855.0, "2022": 23585.0, "2023": 25365.0}, "Ontario": {"Before 1980": 1125.0, "1980": 1974.5454545454545, "1981": 1974.5454545454545, "1982": 2824.090909090909, "1983": 3673.6363636363635, "1984": 4523.181818181818, "1985": 5372.727272727272, "1986": 6222.272727272726, "1987": 7071.81818181818, "1988": 7921.363636363634, "1989": 8770.909090909088, "1990": 9620.454545454542, "19801990": 10470.0, "1991": 12913.0, "1992": 15356.0, "1993": 17799.0, "1994": 20242.0, "1995": 22685.0, "1996": 25128.0, "1997": 27571.0, "1998": 30014.0, "1999": 32457.0, "2000": 34900.0, "19912000": 34900.0, "2001": 38081.0, "2002": 41262.0, "2003": 44443.0, "2004": 47624.0, "2005": 50805.0, "20012005": 50805.0, "2006": 53879.0, "2007": 56953.0, "2008": 60027.0, "2009": 63101.0, "2010": 66175.0, "20062010": 66175.0, "2011": 71055.0, "2012": 75935.0, "2013": 80815.0, "2014": 85695.0, "2015": 90575.0, "20112015": 90575.0, "2016": 93218.0, "2017": 95861.0, "2018": 98504.0, "2019": 101147.0, "2020": 103790.0, "20162021": 103790.0, "2021": 109890.0, "2022": 116090.0, "2023": 122390.0}, "Manitoba": {"Before 1980": 20.0, "1980": 33.63636363636364, "1981": 33.63636363636364, "1982": 47.27272727272728, "1983": 60.90909090909092, "1984": 74.54545454545456, "1985": 88.1818181818182, "1986": 101.81818181818184, "1987": 115.45454545454548, "1988": 129.09090909090912, "1989": 142.72727272727275, "1990": 156.36363636363637, "19801990": 170.0, "1991": 184.5, "1992": 199.0, "1993": 213.5, "1994": 228.0, "1995": 242.5, "1996": 257.0, "1997": 271.5, "1998": 286.0, "1999": 300.5, "2000": 315.0, "19912000": 315.0, "2001": 342.0, "2002": 369.0, "2003": 396.0, "2004": 423.0, "2005": 450.0, "20012005": 450.0, "2006": 481.0, "2007": 512.0, "2008": 543.0, "2009": 574.0, "2010": 605.0, "20062010": 605.0, "2011": 651.0, "2012": 697.0, "2013": 743.0, "2014": 789.0, "2015": 835.0, "20112015": 835.0, "2016": 888.0, "2017": 941.0, "2018": 994.0, "2019": 1047.0, "2020": 1100.0, "20162021": 1100.0, "2021": 1100.0, "2022": 1100.0, "2023": 1100.0}, "Saskatchewan": {"Before 1980": 0.0, "1980": 6.818181818181818, "1981": 6.818181818181818, "1982": 13.636363636363637, "1983": 20.454545454545453, "1984": 27.272727272727273, "1985": 34.09090909090909, "1986": 40.909090909090914, "1987": 47.727272727272734, "1988": 54.545454545454554, "1989": 61.363636363636374, "1990": 68.18181818181819, "19801990": 75.0, "1991": 83.0, "1992": 91.0, "1993": 99.0, "1994": 107.0, "1995": 115.0, "1996": 123.0, "1997": 131.0, "1998": 139.0, "1999": 147.0, "2000": 155.0, "19912000": 155.0, "2001": 168.0, "2002": 181.0, "2003": 194.0, "2004": 207.0, "2005": 220.0, "20012005": 220.0, "2006": 249.0, "2007": 278.0, "2008": 307.0, "2009": 336.0, "2010": 365.0, "20062010": 365.0, "2011": 432.0, "2012": 499.0, "2013": 566.0, "2014": 633.0, "2015": 700.0, "20112015": 700.0, "2016": 767.0, "2017": 834.0, "2018": 901.0, "2019": 968.0, "2020": 1035.0, "20162021": 1035.0, "2021": 1035.0, "2022": 1035.0, "2023": 1035.0}, "Alberta": {"Before 1980": 115.0, "1980": 194.54545454545456, "1981": 194.54545454545456, "1982": 274.0909090909091, "1983": 353.6363636363637, "1984": 433.18181818181824, "1985": 512.7272727272727, "1986": 592.2727272727273, "1987": 671.8181818181818, "1988": 751.3636363636363, "1989": 830.9090909090908, "1990": 910.4545454545453, "19801990": 990.0, "1991": 1121.5, "1992": 1253.0, "1993": 1384.5, "1994": 1516.0, "1995": 1647.5, "1996": 1779.0, "1997": 1910.5, "1998": 2042.0, "1999": 2173.5, "2000": 2305.0, "19912000": 2305.0, "2001": 2586.0, "2002": 2867.0, "2003": 3148.0, "2004": 3429.0, "2005": 3710.0, "20012005": 3710.0, "2006": 4027.0, "2007": 4344.0, "2008": 4661.0, "2009": 4978.0, "2010": 5295.0, "20062010": 5295.0, "2011": 5725.0, "2012": 6155.0, "2013": 6585.0, "2014": 7015.0, "2015": 7445.0, "20112015": 7445.0, "2016": 7729.0, "2017": 8013.0, "2018": 8297.0, "2019": 8581.0, "2020": 8865.0, "20162021": 8865.0, "2021": 8865.0, "2022": 8865.0, "2023": 8865.0}, "British Columbia": {"Before 1980": 610.0, "1980": 965.909090909091, "1981": 965.909090909091, "1982": 1321.818181818182, "1983": 1677.727272727273, "1984": 2033.636363636364, "1985": 2389.545454545455, "1986": 2745.454545454546, "1987": 3101.363636363637, "1988": 3457.272727272728, "1989": 3813.181818181819, "1990": 4169.09090909091, "19801990": 4525.0, "1991": 5692.0, "1992": 6859.0, "1993": 8026.0, "1994": 9193.0, "1995": 10360.0, "1996": 11527.0, "1997": 12694.0, "1998": 13861.0, "1999": 15028.0, "2000": 16195.0, "19912000": 16195.0, "2001": 17451.0, "2002": 18707.0, "2003": 19963.0, "2004": 21219.0, "2005": 22475.0, "20012005": 22475.0, "2006": 23903.0, "2007": 25331.0, "2008": 26759.0, "2009": 28187.0, "2010": 29615.0, "20062010": 29615.0, "2011": 31717.0, "2012": 33819.0, "2013": 35921.0, "2014": 38023.0, "2015": 40125.0, "20112015": 40125.0, "2016": 41295.0, "2017": 42465.0, "2018": 43635.0, "2019": 44805.0, "2020": 45975.0, "20162021": 45975.0, "2021": 49245.0, "2022": 52615.0, "2023": 56035.0}, "Yukon": {"Before 1980": 0.0, "1980": 0.0, "1981": 0.0, "1982": 0.0, "1983": 0.0, "1984": 0.0, "1985": 0.0, "1986": 0.0, "1987": 0.0, "1988": 0.0, "1989": 0.0, "1990": 0.0, "19801990": 0.0, "1991": 0.0, "1992": 0.0, "1993": 0.0, "1994": 0.0, "1995": 0.0, "1996": 0.0, "1997": 0.0, "1998": 0.0, "1999": 0.0, "2000": 0.0, "19912000": 0.0, "2001": 0.0, "2002": 0.0, "2003": 0.0, "2004": 0.0, "2005": 0.0, "20012005": 0.0, "2006": 0.0, "2007": 0.0, "2008": 0.0, "2009": 0.0, "2010": 0.0, "20062010": 0.0, "2011": 0.0, "2012": 0.0, "2013": 0.0, "2014": 0.0, "2015": 0.0, "20112015": 0.0, "2016": 0.0, "2017": 0.0, "2018": 0.0, "2019": 0.0, "2020": 0.0, "20162021": 0.0, "2021": 0.0, "2022": 0.0, "2023": 0.0}, "Northwest Territories": {"Before 1980": 10.0, "1980": 10.0, "1981": 10.0, "1982": 10.0, "1983": 10.0, "1984": 10.0, "1985": 10.0, "1986": 10.0, "1987": 10.0, "1988": 10.0, "1989": 10.0, "1990": 10.0, "19801990": 10.0, "1991": 10.0, "1992": 10.0, "1993": 10.0, "1994": 10.0, "1995": 10.0, "1996": 10.0, "1997": 10.0, "1998": 10.0, "1999": 10.0, "2000": 10.0, "19912000": 10.0, "2001": 12.0, "2002": 14.0, "2003": 16.0, "2004": 18.0, "2005": 20.0, "20012005": 20.0, "2006": 20.0, "2007": 20.0, "2008": 20.0, "2009": 20.0, "2010": 20.0, "20062010": 20.0, "2011": 20.0, "2012": 20.0, "2013": 20.0, "2014": 20.0, "2015": 20.0, "20112015": 20.0, "2016": 20.0, "2017": 20.0, "2018": 20.0, "2019": 20.0, "2020": 20.0, "20162021": 20.0, "2021": 20.0, "2022": 20.0, "2023": 20.0}, "Nunavut": {"Before 1980": 0.0, "1980": 0.0, "1981": 0.0, "1982": 0.0, "1983": 0.0, "1984": 0.0, "1985": 0.0, "1986": 0.0, "1987": 0.0, "1988": 0.0, "1989": 0.0, "1990": 0.0, "19801990": 0.0, "1991": 0.0, "1992": 0.0, "1993": 0.0, "1994": 0.0, "1995": 0.0, "1996": 0.0, "1997": 0.0, "1998": 0.0, "1999": 0.0, "2000": 0.0, "19912000": 0.0, "2001": 0.0, "2002": 0.0, "2003": 0.0, "2004": 0.0, "2005": 0.0, "20012005": 0.0, "2006": 0.0, "2007": 0.0, "2008": 0.0, "2009": 0.0, "2010": 0.0, "20062010": 0.0, "2011": 0.0, "2012": 0.0, "2013": 0.0, "2014": 0.0, "2015": 0.0, "20112015": 0.0, "2016": 0.0, "2017": 0.0, "2018": 0.0, "2019": 0.0, "2020": 0.0, "20162021": 0.0, "2021": 0.0, "2022": 0.0, "2023": 0.0}};

var timeRange = ["Before 1980", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990",
  "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000",
  "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015",
  "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023"
];

var width = 960,
    height = 500,
    active = d3.select(null);

var projection = d3.geoOrthographic().clipAngle(90).rotate([98, -60]).scale(600).translate([500,200])
    .scale(700)
    .translate([width / 2, height / 2]);

// var zoom = d3.behavior.zoom()
//     .translate([0, 0])
//     .scale(1)
//     .scaleExtent([1, 100])
//     .on("zoom", zoomed);

var path = d3.geoPath(projection);

var svg = d3.select("#scene").append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("style", "margin-top: 50px;")
    .on("click", stopped, true);

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height)
    .on("click", reset);

  
const colorAssigment = function (d, indx, tIndex) {
  const startColor = { r: 230, g: 239, b: 252 }; // Light blue
  const endColor = { r: 0, g: 0, b: 153 }; // Dark blue

  if (d['type'] !== "Feature") {
    return;
  }

  updateCAAnnotations(svg, Math.ceil(populationData["Canada"][tIndex]), tIndex);
  updateBCAnnotations(svg, Math.ceil(populationData["British Columbia"][tIndex]));
  updateONAnnotations(svg, Math.ceil(populationData["Ontario"][tIndex]));
  updateQCAnnotations(svg, Math.ceil(populationData["Quebec"][tIndex]));
  
  const normalizedValue = (populationData[d["id"]][tIndex] - 0) / 122390;
  
  const r = Math.round(startColor.r + normalizedValue * (endColor.r - startColor.r));
  const g = Math.round(startColor.g + normalizedValue * (endColor.g - startColor.g));
  const b = Math.round(startColor.b + normalizedValue * (endColor.b - startColor.b));

  // Convert the components to a hex string
  const hex = (r << 16 | g << 8 | b).toString(16).padStart(6, '0');
  
  return `#${hex}`;
}


var g = svg.append("g");

const can = await d3.json("https://gist.githubusercontent.com/AldermanAxe/fdd6459122babdfe1c4d/raw/012f2d5505325de2f9804d4c6ef8a4868ec894aa/canada.topo.json.txt");


  g.selectAll("path")
      .data(topojson.feature(can, can.objects['provinces']).features)
    .enter().append("path")
      .attr("d", path)
      .attr("class", "feature")
      .style("fill", function(d, i){ return colorAssigment(d, "Before 1980"); })
      .on("click", clicked);


timeRange.forEach(function(obj, index) {
    
  setTimeout(function(){
      g.selectAll("path")
          .transition()
          .style("fill", function(d){ return colorAssigment(d, index, timeRange[index]); })
    }, 700 * index);
});


g.append("path")
    .datum(topojson.mesh(can, can.objects['provinces'], function(a, b) { return a !== b; }))
    .attr("class", "mesh")
    .attr("d", path);

function clicked(d) {
  if (active.node() === this) return reset();
  active.classed("active", false);
  active = d3.select(this).classed("active", true);

  var bounds = path.bounds(d),
      dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = .9 / Math.max(dx / width, dy / height),
      translate = [width / 2 - scale * x, height / 2 - scale * y];

  svg.transition()
      .duration(750)
      .call(zoom.translate(translate).scale(scale).event);
}

function reset() {
  active.classed("active", false);
  active = d3.select(null);

  svg.transition()
      .duration(750)
      .call(zoom.translate([0, 0]).scale(1).event);
}

function zoomed() {
  g.style("stroke-width", 1.5 / d3.event.scale + "px");
  g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
}

// If the drag behavior prevents the default click,
// also stop propagation so we don’t click-to-zoom.
function stopped() {
  if (d3.event.defaultPrevented) d3.event.stopPropagation();
}

}
</script>

</body>
</html>